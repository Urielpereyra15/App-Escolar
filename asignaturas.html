<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Materias</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: #334455;
    color: white;
  }

  nav {
    background-color: #111;
    padding: 10px;
    display: flex;
    justify-content: center;
    gap: 20px;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  nav a { color: white; text-decoration: none; font-weight: bold; }
  nav a:hover { text-decoration: underline; }

  .materia-container {
    background-color: #223c63;
    border-radius: 12px;
    padding: 20px;
    margin: 20px auto;
    max-width: 700px;
  }

  .header { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 15px; }

  .section {
    background-color: #2f61a3;
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 15px;
  }

  .section-title { display: flex; justify-content: space-between; align-items: center; font-weight: bold; margin-bottom: 8px; }

  .add-btn {
    background: #fff;
    color: #1e56a0;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-weight: bold;
    width: 25px;
    height: 25px;
    text-align: center;
  }

  .profesor, .unidad, .archivo {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-left: 15px;
    margin-bottom: 5px;
    cursor: pointer;
  }

  .profesor button, .unidad button, .archivo button {
    background: transparent;
    border: none;
    color: white;
    font-weight: bold;
    cursor: pointer;
    font-size: 16px;
    margin: 0;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 100;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
  }

  .modal-content {
    background: #fff;
    color: black;
    padding: 20px;
    border-radius: 12px;
    width: 400px;
    margin: 100px auto;
  }

  .close { float: right; cursor: pointer; font-weight: bold; font-size: 20px; }

  img { max-width: 100%; margin-top: 10px; border-radius: 10px; }

  a { color: white; text-decoration: underline; }
</style>
</head>
<body>

<nav>
  <a href="index.html">Inicio</a>
  <a href="agenda.html">Agenda</a>
  <a href="calificaciones.html">Calificaciones</a>
  <a href="asignaturas.html">Asignaturas</a>
</nav>

<div id="materias-container"></div>

<!-- Modal Archivos -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3 id="modal-title"></h3>
    <div id="archivos-list"></div>
    <button onclick="triggerFileInput()">+ Agregar archivo</button>
    <input type="file" id="fileInput" style="display:none;" onchange="handleFileUpload(event)">
  </div>
</div>

<script>
// Lista de materias
const materias = [
  "Contabilidad","Administración","Historia de la Cultura","Matemática 1","Derecho Público","Introducción a la Economía",
  "Metodología de la Investigación","Derecho Privado","Contabilidad Superior","Teoría de la Organización","Estadística","Historia Económica","Microeconómia","Filosofía","Matemática 2",
  "Costos 1","Derecho Tributario","Administración Pública","Dirección General","Estados Contables","Derecho Comercial","Derecho Laboral","Macroeconómia","Matemática Financiera y Actuarial","Sistema de Información Administrativa","Teología","Sociología","Costo para la Toma de Decisiones","Remuneración y Beneficios",
  "Auditoria 1","Ética y Deontologia Profesional","Interpretación de Estados Contables","Sociedades","Teoría y Técnica Impositiva 1","Auditoria y Control de Sistema de Información","Gestión Financiera","Derecho Concursal","Auditoria 2","Teoría y Técnica Impositiva 2","Contabilidad Gerencial","Práctica Profesional Supervisada"
];

// LocalStorage
function saveData(key, data){ localStorage.setItem(key, JSON.stringify(data)); }
function loadData(key){ return JSON.parse(localStorage.getItem(key)) || []; }

// Modal
let currentMateria = null;
let currentUnidad = null;

// Generar materias
const container = document.getElementById('materias-container');
materias.forEach(materia => {
  const div = document.createElement('div');
  div.className = 'materia-container';
  div.innerHTML = `
    <div class="header">
      <div>${materia}</div>
      <div>Promedio: 0,00</div>
    </div>
    <div class="section">
      <div class="section-title">
        Profesores:
        <button class="add-btn" onclick="addProfesor('${materia}')">+</button>
      </div>
      <div id="profesores-${materia}"></div>
    </div>
    <div class="section">
      <div class="section-title">
        Clases:
        <button class="add-btn" onclick="addUnidad('${materia}')">+</button>
      </div>
      <div id="clases-${materia}"></div>
    </div>
    <div class="section">
      <div class="section-title">Condiciones para aprobar</div>
      <input type="file" accept="image/*" onchange="uploadImage(event,'condiciones-${materia}')">
      <div id="condiciones-${materia}"></div>
    </div>
    <div class="section">
      <div class="section-title">Cronograma</div>
      <input type="file" accept="image/*" onchange="uploadImage(event,'cronograma-${materia}')">
      <div id="cronograma-${materia}"></div>
    </div>
  `;
  container.appendChild(div);
});

// Profesores
function renderProfesores(materia){
  const profesores = loadData('profesores-'+materia);
  document.getElementById('profesores-'+materia).innerHTML =
    profesores.map((p,i)=>`<div class="profesor">${p} <button onclick="deleteProfesor('${materia}',${i})">x</button></div>`).join('');
}

function addProfesor(materia){
  const nombre = prompt("Nombre del profesor:");
  if(nombre){
    const profesores = loadData('profesores-'+materia);
    profesores.push(nombre);
    saveData('profesores-'+materia, profesores);
    renderProfesores(materia);
  }
}

function deleteProfesor(materia,index){
  const profesores = loadData('profesores-'+materia);
  profesores.splice(index,1);
  saveData('profesores-'+materia, profesores);
  renderProfesores(materia);
}

// Unidades
function renderClases(materia){
  const clases = loadData('clases-'+materia);
  document.getElementById('clases-'+materia).innerHTML =
    clases.map((u,i)=>`<div class="unidad"><span onclick="openModal(${i},'${materia}')">${u.titulo}</span> <button onclick="deleteUnidad('${materia}',${i})">x</button></div>`).join('');
}

function addUnidad(materia){
  const titulo = prompt("Título de la unidad:");
  if(titulo){
    const clases = loadData('clases-'+materia);
    clases.push({titulo, archivos: []});
    saveData('clases-'+materia, clases);
    renderClases(materia);
  }
}

function deleteUnidad(materia,index){
  const clases = loadData('clases-'+materia);
  clases.splice(index,1);
  saveData('clases-'+materia, clases);
  renderClases(materia);
}

// Modal Archivos
function openModal(index,materia){
  currentUnidad = index;
  currentMateria = materia;
  const clases = loadData('clases-'+materia);
  document.getElementById('modal-title').textContent = clases[index].titulo;
  renderArchivos();
  document.getElementById('modal').style.display='block';
}

function closeModal(){ document.getElementById('modal').style.display='none'; }
function triggerFileInput(){ document.getElementById('fileInput').click(); }

function handleFileUpload(event){
  const file = event.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      const clases = loadData('clases-'+currentMateria);
      clases[currentUnidad].archivos.push({nombre:file.name, data:e.target.result});
      saveData('clases-'+currentMateria, clases);
      renderArchivos();
    }
    reader.readAsDataURL(file);
  }
}

function renderArchivos(){
  const clases = loadData('clases-'+currentMateria);
  const archivos = clases[currentUnidad].archivos;
  document.getElementById('archivos-list').innerHTML =
    archivos.map((a,i)=>`
      <div class="archivo">
        <a href="${a.data}" target="_blank">${a.nombre}</a>
        <button onclick="deleteArchivo(${i})">x</button>
      </div>
    `).join('');
}

function deleteArchivo(index){
  const clases = loadData('clases-'+currentMateria);
  clases[currentUnidad].archivos.splice(index,1);
  saveData('clases-'+currentMateria, clases);
  renderArchivos();
}

// Imágenes
function uploadImage(event,containerId){
  const file = event.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      localStorage.setItem(containerId,e.target.result);
      document.getElementById(containerId).innerHTML=`<img src="${e.target.result}">`;
    }
    reader.readAsDataURL(file);
  }
}

// Inicializar
materias.forEach(materia=>{
  renderProfesores(materia);
  renderClases(materia);
  ['condiciones-'+materia,'cronograma-'+materia].forEach(id=>{
    const data = localStorage.getItem(id);
    if(data) document.getElementById(id).innerHTML=`<img src="${data}">`;
  });
});
</script>
</body>
</html>
