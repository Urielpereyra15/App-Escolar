<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Materia</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #223c63;
      color: white;
      margin: 0;
      padding: 20px;
    }

    h2 {
      margin: 0;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .section {
      background-color: #2f61a3;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 10px;
    }

    .section h3 {
      margin-top: 0;
    }

    .list-item {
      margin-left: 15px;
      cursor: pointer;
    }

    .plus-btn {
      display: inline-block;
      background: #1657a2;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 3px 8px;
      margin-left: 8px;
      cursor: pointer;
    }

    .delete-btn {
      margin-left: 10px;
      color: #ff6666;
      cursor: pointer;
      font-weight: bold;
    }

    /* Ventana emergente */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: #2f61a3;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      color: white;
    }

    .close {
      float: right;
      cursor: pointer;
      font-weight: bold;
    }

    img {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h2>Materia</h2>
    <span>Promedio: 0,00</span>
  </div>

  <!-- Profesores -->
  <div class="section">
    <h3>Profesores:</h3>
    <ul id="profesores-list"></ul>
    <button class="plus-btn" onclick="agregarProfesor()">+</button>
  </div>

  <!-- Clases -->
  <div class="section">
    <h3>Clases:</h3>
    <ul id="clases-list"></ul>
    <button class="plus-btn" onclick="agregarClase()">+</button>
  </div>

  <!-- Condiciones para aprobar -->
  <div class="section">
    <h3>Condiciones para aprobar</h3>
    <input type="file" accept="image/*" onchange="mostrarImagen(event, 'condiciones-img', 'condiciones')">
    <img id="condiciones-img" alt="">
  </div>

  <!-- Cronograma -->
  <div class="section">
    <h3>Cronograma</h3>
    <input type="file" accept="image/*" onchange="mostrarImagen(event, 'cronograma-img', 'cronograma')">
    <img id="cronograma-img" alt="">
  </div>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarModal()">&times;</span>
      <h3 id="modal-title"></h3>
      <ul id="archivos-list"></ul>
      <button class="plus-btn" onclick="agregarArchivo()">+</button>
    </div>
  </div>

  <script>
    let profesores = [];
    let clases = [];
    let archivos = {};
    let claseActual = "";

    // Guardar todo en localStorage
    function guardarDatos() {
      localStorage.setItem("profesores", JSON.stringify(profesores));
      localStorage.setItem("clases", JSON.stringify(clases));
      localStorage.setItem("archivos", JSON.stringify(archivos));
    }

    // Cargar todo desde localStorage
    function cargarDatos() {
      const profGuardados = JSON.parse(localStorage.getItem("profesores"));
      const clasesGuardadas = JSON.parse(localStorage.getItem("clases"));
      const archivosGuardados = JSON.parse(localStorage.getItem("archivos"));

      if (profGuardados) {
        profesores = profGuardados;
        profesores.forEach(nombre => mostrarProfesor(nombre));
      }

      if (clasesGuardadas) {
        clases = clasesGuardadas;
        clases.forEach(c => mostrarClase(c));
      }

      if (archivosGuardados) {
        archivos = archivosGuardados;
      }

      // Restaurar imágenes
      const condiciones = localStorage.getItem("condiciones");
      if (condiciones) document.getElementById("condiciones-img").src = condiciones;

      const cronograma = localStorage.getItem("cronograma");
      if (cronograma) document.getElementById("cronograma-img").src = cronograma;
    }

    // Profesores
    function agregarProfesor() {
      const nombre = prompt("Ingrese el nombre del profesor:");
      if (nombre) {
        profesores.push(nombre);
        mostrarProfesor(nombre);
        guardarDatos();
      }
    }

    function mostrarProfesor(nombre) {
      const li = document.createElement("li");
      li.textContent = nombre;

      const btn = document.createElement("span");
      btn.textContent = "❌";
      btn.className = "delete-btn";
      btn.onclick = () => eliminarProfesor(nombre, li);

      li.appendChild(btn);
      document.getElementById("profesores-list").appendChild(li);
    }

    function eliminarProfesor(nombre, li) {
      profesores = profesores.filter(p => p !== nombre);
      li.remove();
      guardarDatos();
    }

    // Clases
    function agregarClase() {
      const titulo = prompt("Ingrese el título de la clase:");
      if (titulo) {
        clases.push(titulo);
        archivos[titulo] = [];
        mostrarClase(titulo);
        guardarDatos();
      }
    }

    function mostrarClase(titulo) {
      const li = document.createElement("li");
      li.textContent = titulo;
      li.className = "list-item";
      li.onclick = e => {
        if (e.target.tagName !== "SPAN") abrirModal(titulo);
      };

      const btn = document.createElement("span");
      btn.textContent = "❌";
      btn.className = "delete-btn";
      btn.onclick = e => {
        e.stopPropagation();
        eliminarClase(titulo, li);
      };

      li.appendChild(btn);
      document.getElementById("clases-list").appendChild(li);
    }

    function eliminarClase(titulo, li) {
      clases = clases.filter(c => c !== titulo);
      delete archivos[titulo];
      li.remove();
      guardarDatos();
    }

    // Modal de archivos
    function abrirModal(clase) {
      claseActual = clase;
      document.getElementById("modal-title").textContent = clase;
      mostrarArchivos();
      document.getElementById("modal").style.display = "flex";
    }

    function cerrarModal() {
      document.getElementById("modal").style.display = "none";
    }

    function mostrarArchivos() {
      const lista = document.getElementById("archivos-list");
      lista.innerHTML = "";
      archivos[claseActual].forEach(a => {
        const li = document.createElement("li");
        li.textContent = a;

        const btn = document.createElement("span");
        btn.textContent = "❌";
        btn.className = "delete-btn";
        btn.onclick = () => eliminarArchivo(a, li);

        li.appendChild(btn);
        lista.appendChild(li);
      });
    }

    function agregarArchivo() {
      const nombre = prompt("Ingrese el nombre del archivo:");
      if (nombre) {
        archivos[claseActual].push(nombre);
        mostrarArchivos();
        guardarDatos();
      }
    }

    function eliminarArchivo(nombre, li) {
      archivos[claseActual] = archivos[claseActual].filter(a => a !== nombre);
      li.remove();
      guardarDatos();
    }

    // Subir y mostrar imagen con persistencia en localStorage
    function mostrarImagen(event, imgId, key) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          const dataUrl = e.target.result;
          document.getElementById(imgId).src = dataUrl;
          localStorage.setItem(key, dataUrl); // Guardar en localStorage
        };
        reader.readAsDataURL(file);
      }
    }

    // Inicializar datos
    window.onload = cargarDatos;
  </script>
</body>
</html>
