<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Escolar</title>
<style>
    body { font-family: Arial, sans-serif; background-color: #334455; color: white; margin:0; padding:0;}
    .header { display: flex; align-items: center; background-color: #1657a2; padding: 15px; }
    .hamburger { font-size: 24px; cursor: pointer; margin-right: 10px; }
    h1 { margin:0; font-size: 1.5em; }

    .container { max-width: 600px; margin:20px auto; }

    .calendar-section, .agenda-section { background-color:#1a2b3c; padding:20px; border-radius:15px; margin-bottom:20px; }
    .month-year-nav { display:flex; justify-content: space-between; align-items:center; margin-bottom:15px; }
    .month, .year { background-color:#004080; padding:8px 15px; border-radius:20px; font-weight:bold; }
    .days-grid { display:grid; grid-template-columns: repeat(7,1fr); gap:10px; }
    .day-header { font-weight:bold; text-align:center; }
    .day { padding:10px; border-radius:5px; background-color:#1657a2; text-align:center; position:relative; }
    .day.weekend { background-color:#15202b; }
    .day.current-day { border:2px solid #0056b3; background:transparent; border-radius:50%; padding:8px; }
    .day.has-event::after { content:''; position:absolute; bottom:3px; left:50%; transform:translateX(-50%); width:6px; height:6px; background-color:#f0c300; border-radius:50%; }

    .agenda-header { display:flex; justify-content: space-between; align-items:center; margin-bottom:15px; }
    .icon-plus { font-size:24px; cursor:pointer; }

    .agenda-item { background-color:#004080; padding:15px; border-radius:10px; margin-bottom:10px; position:relative; }
    .date-label { font-weight:bold; font-size:0.9em; }
    .event-title { margin-top:5px; font-size:1.1em; }
    .delete-event { position:absolute; top:5px; right:10px; cursor:pointer; color:red; font-weight:bold; }

    /* Modal */
    #eventModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; }
    #eventModal div { background:#1a2b3c; padding:20px; border-radius:15px; width:90%; max-width:400px; color:white; }
    #eventModal input { width:100%; padding:8px; margin:5px 0; border-radius:5px; border:none; }
    #eventModal button { padding:10px 20px; border:none; border-radius:10px; cursor:pointer; margin:5px; }
    #saveEventBtn { background:#1657a2; color:white; }
    #closeModalBtn { background:#555; color:white; }
</style>
</head>
<body>

<div class="header">
    <div class="hamburger">☰</div>
    <h1>Mi Escuela</h1>
</div>

<div class="container">
    <div class="calendar-section">
        <div class="month-year-nav">
            <button id="prevBtn" style="background:none;border:none;color:white;font-size:1.5em;cursor:pointer">&lt;</button>
            <div id="monthDisplay" class="month"></div>
            <div id="yearDisplay" class="year"></div>
            <button id="nextBtn" style="background:none;border:none;color:white;font-size:1.5em;cursor:pointer">&gt;</button>
        </div>
        <div class="days-grid" id="daysGrid"></div>
    </div>

    <div class="agenda-section">
        <div class="agenda-header">
            <h2>Agenda</h2>
            <span class="icon-plus" id="plusBtn">+</span>
        </div>
        <div id="eventsList"></div>
    </div>
</div>

<!-- Modal -->
<div id="eventModal">
    <div>
        <h3 style="text-align:center;">Agregar Evento</h3>
        <label>Fecha y hora:</label>
        <input type="datetime-local" id="eventDateTime">
        <label>Materia:</label>
        <input type="text" id="eventSubject" placeholder="Ej: Matemática">
        <label>Link de Zoom:</label>
        <input type="text" id="eventLink" placeholder="https://...">
        <div style="text-align:center; margin-top:10px;">
            <button id="saveEventBtn">Guardar</button>
            <button id="closeModalBtn">Cancelar</button>
        </div>
    </div>
</div>

<script>
const monthDisplay = document.getElementById('monthDisplay');
const yearDisplay = document.getElementById('yearDisplay');
const daysGrid = document.getElementById('daysGrid');
const eventsList = document.getElementById('eventsList');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const modal = document.getElementById('eventModal');
const plusBtn = document.getElementById('plusBtn');
const closeModalBtn = document.getElementById('closeModalBtn');
const saveEventBtn = document.getElementById('saveEventBtn');
const eventDateTime = document.getElementById('eventDateTime');
const eventSubject = document.getElementById('eventSubject');
const eventLink = document.getElementById('eventLink');

const months = ["ENERO","FEBRERO","MARZO","ABRIL","MAYO","JUNIO","JULIO","AGOSTO","SEPTIEMBRE","OCTUBRE","NOVIEMBRE","DICIEMBRE"];
const weekDays = ["LU","MA","MI","JU","VI","SA","DO"];
let currentDate = new Date();

// Cargar eventos desde localStorage
let events = JSON.parse(localStorage.getItem('events')) || [];

function saveLocal() { localStorage.setItem('events', JSON.stringify(events)); }

function renderCalendar() {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    monthDisplay.textContent = months[month];
    yearDisplay.textContent = year;
    daysGrid.innerHTML = '';

    weekDays.forEach(day => { 
        const headerEl = document.createElement('div'); 
        headerEl.classList.add('day-header'); 
        headerEl.textContent = day; 
        daysGrid.appendChild(headerEl); 
    });

    const firstDayOfMonth = new Date(year, month,1).getDay();
    const lastDayOfMonth = new Date(year, month+1,0).getDate();
    const firstDayIndex = (firstDayOfMonth+6)%7;

    for(let i=0;i<firstDayIndex;i++) daysGrid.appendChild(document.createElement('div'));

    for(let day=1;day<=lastDayOfMonth;day++){
        const dayEl = document.createElement('div');
        dayEl.classList.add('day');
        dayEl.textContent = day;
        const dayOfWeek = (firstDayIndex+day-1)%7;
        if(dayOfWeek>=5) dayEl.classList.add('weekend');

        const today = new Date();
        if(day===today.getDate() && month===today.getMonth() && year===today.getFullYear())
            dayEl.classList.add('current-day');

        const dayEvents = events.filter(e=>e.date===`${year}-${month}-${day}`);
        if(dayEvents.length>0) dayEl.classList.add('has-event');

        daysGrid.appendChild(dayEl);
    }

    renderEvents();
}

function renderEvents(){
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    eventsList.innerHTML='';

    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate()+1);

    const monthlyEvents = events.filter(e=>{
        const evDate = new Date(e.dateTime);
        return evDate.getFullYear()===year && evDate.getMonth()===month;
    }).sort((a,b)=>new Date(a.dateTime)-new Date(b.dateTime));

    if(monthlyEvents.length>0){
        monthlyEvents.forEach(event=>{
            const item = document.createElement('div');
            item.classList.add('agenda-item');
            const evDate = new Date(event.dateTime);
            let dateLabel='';
            if(evDate.toDateString()===today.toDateString()) dateLabel='Hoy';
            else if(evDate.toDateString()===tomorrow.toDateString()) dateLabel='Mañana';
            else dateLabel=`${evDate.getDate()} de ${months[evDate.getMonth()]}`;

            item.innerHTML=`
                <div class="date-label">${dateLabel}</div>
                <div class="event-title">${event.subject} - <a href="${event.link}" target="_blank" style="color:#f0c300;">Zoom</a></div>
                <span class="delete-event">×</span>
            `;

            item.querySelector('.delete-event').addEventListener('click', ()=>{
                events = events.filter(e=>e.id!==event.id);
                saveLocal();
                renderCalendar();
            });

            eventsList.appendChild(item);
        });
    } else {
        const item = document.createElement('div');
        item.classList.add('agenda-item');
        item.innerHTML='<div class="event-title" style="text-align:center;">No hay eventos para este mes.</div>';
        eventsList.appendChild(item);
    }
}

prevBtn.addEventListener('click', ()=>{
    currentDate.setMonth(currentDate.getMonth()-1);
    renderCalendar();
});
nextBtn.addEventListener('click', ()=>{
    currentDate.setMonth(currentDate.getMonth()+1);
    renderCalendar();
});
plusBtn.addEventListener('click', ()=>{ modal.style.display='flex'; });
closeModalBtn.addEventListener('click', ()=>{
    modal.style.display='none';
    eventDateTime.value=''; eventSubject.value=''; eventLink.value='';
});
saveEventBtn.addEventListener('click', ()=>{
    const datetime=eventDateTime.value;
    const subject=eventSubject.value.trim();
    const link=eventLink.value.trim();
    if(!datetime||!subject||!link){ alert("Completa todos los campos"); return; }

    events.push({
        id: Date.now(),
        dateTime: datetime,
        subject: subject,
        link: link
    });
    saveLocal();
    modal.style.display='none';
    eventDateTime.value=''; eventSubject.value=''; eventLink.value='';
    renderCalendar();
});

renderCalendar();
</script>
</body>
</html>
