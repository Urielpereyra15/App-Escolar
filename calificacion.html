<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calificaciones</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background-color:#334455; color:white; }
    .navbar { background-color:#0b2c56; padding:10px; display:flex; justify-content:center; gap:10px; position:sticky; top:0; }
    .navbar a { text-decoration:none; color:white; background-color:#0d4a8c; padding:10px 15px; border-radius:10px; font-size:14px; display: inline-block; }
    .navbar a:hover { background-color:#1565c0; }
    .header { background-color:#0d3d77; padding:15px; display:flex; justify-content:space-between; align-items:center; border-radius:10px; margin:15px; }
    .header h1 { font-size:22px; margin:0; display:flex; align-items:center; gap:8px; }
    .add-btn { background:#0d3d77; border:none; color:white; font-size:20px; padding:5px 15px; border-radius:10px; cursor:pointer; }
    .materia { background-color:#0d3d77; padding:15px; border-radius:15px; margin:15px; }
    .materia h2 { margin:0 0 10px; font-size:18px; }
    .calificacion { display:flex; flex-direction:column; align-items:flex-start; background:#1657a2; padding:10px; border-radius:15px; margin:8px 0; position:relative; }
    .calificacion span.nota { color:black; font-weight:bold; border-radius:50%; width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center; margin-right:10px; }
    .calificacion span.rojo { background:#ff4d4d; }
    .calificacion span.amarillo { background:#ffd633; }
    .calificacion span.verde { background:#4dff4d; }
    .calificacion small { margin-left:38px; font-size:12px; color:#ddd; }
    .btn-borrar { position:absolute; top:5px; right:5px; background:#ff4d4d; border:none; color:white; border-radius:5px; cursor:pointer; padding:2px 6px; font-size:12px; }
    .btn-borrar:hover { background:#ff1a1a; }
    .modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
    .modal-content { background:#1e4a8a; padding:20px; border-radius:15px; width:300px; color:white; }
    .modal-content input, .modal-content select { width:100%; padding:6px; border-radius:8px; border:none; margin-top:3px; }
    .cerrar { float:right; font-size:20px; cursor:pointer; }
    button[type="submit"] { background:#285ca8; border:none; color:white; padding:8px 15px; border-radius:10px; cursor:pointer; font-size:16px; }
    button[type="submit"]:hover { background:#3b7ddb; }
    .filtros { margin:15px; display:flex; gap:10px; flex-wrap:wrap; }
    .filtros select { padding:5px 8px; border-radius:8px; border:none; }
  </style>
</head>
<body>

<div class="navbar">
  <a href="index.html">üè† Inicio</a>
  <a href="agenda.html">üìí Agenda</a>
  <a href="calificacion.html">‚≠ê Calificaci√≥n</a>
  <a href="asignaturas.html">üéì Asignaturas</a>
  <a href="malla-curricular.html">üìë Malla Curricular</a>
</div>

<div class="header">
  <h1>‚≠ê Calificaciones</h1>
  <button class="add-btn" onclick="abrirModal()">+</button>
</div>

<!-- Filtros -->
<div class="filtros">
  <select id="filtroMateria">
    <option value="">Todas las materias</option>
  </select>
  <select id="filtroTipo">
    <option value="">Todos los tipos</option>
    <option>Parcial</option>
    <option>Foro</option>
    <option>Auto-evaluaci√≥n (obligatoria)</option>
    <option>Auto-evaluaci√≥n (no obligatoria)</option>
    <option>Parcial Promocional</option>
    <option>Examen Final</option>
  </select>
</div>

<div id="materias-container"></div>

<!-- Modal de nueva calificaci√≥n -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="cerrar" onclick="cerrarModal()">&times;</span>
    <h2>Nueva Calificaci√≥n</h2>
    <form id="formCalificacion">
      <label>Materia:</label><br>
      <select id="materia" required></select><br><br>

      <label>Tipo de evaluaci√≥n:</label><br>
      <select id="tipo" required>
        <option>Parcial</option>
        <option>Foro</option>
        <option>Auto-evaluaci√≥n (obligatoria)</option>
        <option>Auto-evaluaci√≥n (no obligatoria)</option>
        <option>Parcial Promocional</option>
        <option>Examen Final</option>
      </select><br><br>

      <label>Sistema de nota:</label><br>
      <select id="sistemaNota" required>
        <option value="1-10">1 a 10</option>
        <option value="0-100">0 a 100</option>
        <option value="0-1">0/1</option>
        <option value="si-no">S√≠/No</option>
      </select><br><br>

      <label>Nota:</label><br>
      <input type="text" id="nota" required><br><br>

      <label>M√≠nimo aprobado:</label><br>
      <input type="number" id="minAprobado" value="7" min="0" max="100" required><br><br>

      <label>Fecha:</label><br>
      <input type="date" id="fecha" required><br><br>

      <button type="submit">Guardar</button>
    </form>
  </div>
</div>

<script>
// Materias con su a√±o (lo seguimos guardando aunque no filtremos por a√±o)
const materiasAno = {
  "Contabilidad":"1ro","Administraci√≥n":"1ro","Historia de la Cultura":"1ro","Matem√°tica 1":"1ro","Derecho P√∫blico":"1ro","Introducci√≥n a la Econom√≠a":"1ro",
  "Metodolog√≠a de la Investigaci√≥n":"2do","Derecho Privado":"2do","Contabilidad Superior":"2do","Teor√≠a de la Organizaci√≥n":"2do","Estad√≠stica":"2do",
  "Historia Econ√≥mica":"2do","Microecon√≥mia":"2do","Filosof√≠a":"2do","Matem√°tica 2":"2do",
  "Costos 1":"3ro","Derecho Tributario":"3ro","Administraci√≥n P√∫blica":"3ro","Direcci√≥n General":"3ro","Estados Contables":"3ro","Derecho Comercial":"3ro",
  "Derecho Laboral":"3ro","Macroecon√≥mia":"3ro","Matem√°tica Financiera y Actuarial":"3ro","Sistema de Informaci√≥n Administrativa":"3ro","Teolog√≠a":"3ro",
  "Sociolog√≠a":"3ro","Costo para la Toma de Decisiones":"3ro","Remuneraci√≥n y Beneficios":"3ro",
  "Auditoria 1":"4to","√âtica y Deontologia Profesional":"4to","Interpretaci√≥n de Estados Contables":"4to","Sociedades":"4to","Teor√≠a y T√©cnica Impositiva 1":"4to",
  "Auditoria y Control de Sistema de Informaci√≥n":"4to","Gesti√≥n Financiera":"4to","Derecho Concursal":"4to","Auditoria 2":"4to","Teor√≠a y T√©cnica Impositiva 2":"4to",
  "Contabilidad Gerencial":"4to","Pr√°ctica Profesional Supervisada":"4to"
};

// Inicializar selects
const materiaSelect = document.getElementById("materia");
const filtroMateria = document.getElementById("filtroMateria");
const materiasContainer = document.getElementById("materias-container");

for(let mat in materiasAno){
  let option = document.createElement("option");
  option.value = mat; option.textContent = mat; materiaSelect.appendChild(option);

  let fOption = document.createElement("option");
  fOption.value = mat; fOption.textContent = mat; filtroMateria.appendChild(fOption);
}

// Modal
function abrirModal(){ document.getElementById("modal").style.display="flex"; }
function cerrarModal(){ document.getElementById("modal").style.display="none"; }

// Color nota
function colorNota(nota,sistema,minAprobado){
  nota = nota.toString().trim(); minAprobado = parseFloat(minAprobado);
  if(sistema==="1-10"){ nota=parseFloat(nota); if(nota<minAprobado-2) return "rojo"; if(nota>=minAprobado-2 && nota<minAprobado) return "amarillo"; return "verde"; }
  if(sistema==="0-100"){ nota=parseFloat(nota); if(nota<minAprobado-10) return "rojo"; if(nota>=minAprobado-10 && nota<minAprobado) return "amarillo"; return "verde"; }
  if(sistema==="0-1") return nota==="0"?"rojo":"verde";
  if(sistema==="si-no") return nota.toLowerCase()==="no"?"rojo":"verde";
  return "";
}

// Guardar y borrar
function guardarCalificacion(obj){
  let calificaciones = JSON.parse(localStorage.getItem("calificaciones")||"[]");
  calificaciones.push(obj);
  localStorage.setItem("calificaciones", JSON.stringify(calificaciones));
}

function borrarCalificacion(index){
  let calificaciones = JSON.parse(localStorage.getItem("calificaciones")||"[]");
  calificaciones.splice(index,1);
  localStorage.setItem("calificaciones", JSON.stringify(calificaciones));
  cargarCalificaciones();
}

// Cargar calificaciones con filtros
function cargarCalificaciones(){
  materiasContainer.innerHTML = "";
  let calificaciones = JSON.parse(localStorage.getItem("calificaciones")||"[]");

  let matFiltro = document.getElementById("filtroMateria").value;
  let tipoFiltro = document.getElementById("filtroTipo").value;

  let calificacionesPorMateria = {};

  calificaciones.forEach((c,index)=>{
    if((!matFiltro || c.materia===matFiltro) &&
       (!tipoFiltro || c.tipo===tipoFiltro)){
      if(!calificacionesPorMateria[c.materia]) calificacionesPorMateria[c.materia]=[];
      calificacionesPorMateria[c.materia].push({...c,index});
    }
  });

  for(let mat in calificacionesPorMateria){
    let divMateria = document.createElement("div");
    divMateria.classList.add("materia");
    divMateria.dataset.nombre = mat;
    divMateria.innerHTML = `<h2>${mat}</h2>`;

    calificacionesPorMateria[mat].forEach(c=>{
      let divCalif = document.createElement("div");
      divCalif.classList.add("calificacion");
      divCalif.innerHTML = `
        <div><span class="nota ${colorNota(c.nota,c.sistema,c.minAprobado)}">${c.nota}</span> ${c.materia} - ${c.tipo} - ${c.sistema} - ${c.ano}</div>
        <small>${c.fecha}</small>
        <button class="btn-borrar" onclick="borrarCalificacion(${c.index})">üóëÔ∏è</button>
      `;
      divMateria.appendChild(divCalif);
    });

    materiasContainer.appendChild(divMateria);
  }
}

// Formulario
document.getElementById("formCalificacion").addEventListener("submit",function(e){
  e.preventDefault();
  let materia=document.getElementById("materia").value;
  let tipo=document.getElementById("tipo").value;
  let sistema=document.getElementById("sistemaNota").value;
  let nota=document.getElementById("nota").value;
  let minAprobado=document.getElementById("minAprobado").value;
  let fecha=document.getElementById("fecha").value;
  let ano = materiasAno[materia];

  let obj={materia,tipo,sistema,nota,minAprobado,fecha,ano};
  guardarCalificacion(obj);
  cerrarModal();
  e.target.reset();
  cargarCalificaciones();
});

// Filtros
document.getElementById("filtroMateria").addEventListener("change",cargarCalificaciones);
document.getElementById("filtroTipo").addEventListener("change",cargarCalificaciones);

window.onload=cargarCalificaciones;
</script>

</body>
</html>
